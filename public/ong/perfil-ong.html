<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfil</title>
    <link rel="stylesheet" href="../css/index.css" />
    <link rel="stylesheet" href="../css/pages/perfil/perfil.css" />
    <link rel="stylesheet" href="../css/partials/navbar.css" />
    <link rel="stylesheet" href="../css/pages/feed/feed.css">
    <link rel="stylesheet" href="../css/partials/search.css">
      <link rel="stylesheet" href="../css/carregamento.css" />
  </head>

  <body>
                  <div id="loading-screen">
        <div class="loader-container">
            <div class="logo-reveal"></div>
            <div class="carregamentoTexto">
                <h1>Carregando</h1>
                <div class="dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </div>
      <header>
      <!--Navbar-->
      <nav class="navbar">
        <div
          class="flex"
          style="justify-content: flex-start; width: 100%; gap: 1.5rem">
          <div style="line-height: 50px">
            <button class="hamburger" id="hamburger"></button>
          </div>
          <ul class="nav-links" id="navlinks">
            <li><a href="feed.html">Explorar</a></li>
            <li><a href="ongsFiltro.html">ONGs</a></li>
          </ul>
          <a class="nav-title" href="../ong/feed.html"
            ><img
              src="../assets/svg/Logo UneONG FINAL.svg"
              alt=""
              width="80"
              height="80"
          /></a>
        </div>

        <div style="display: flex; flex-direction: column; position: relative;">
        <input type="text" name="txtbuscar" id="txtbuscar" class="buscar" placeholder="Procure uma ong..." />
        <div id="results" class="results" ></div>
      </div>
        <label for="txtbuscar"><img src="../assets/png/icones/icone_buscar.png" class="buscarIcon" alt=""></label>
        

        <div
          class="nav-elements"
          style="width: 100px; justify-content: flex-end; padding-left: 1rem"
        >
          <div class="icon-menu">
            <img
              src="../assets/png/user-example.png"
              alt=""
              id="dropdown-perfil"
            />
          </div>
          <div class="dropdown" id="dropdownMenu">
            <div class="flex" style="width: 100%">
              <img
                class="foto-perfil"
                src="../assets/jpg/foto-perfil-exemplo.jpg"
                alt=""
              />
              <div class="mn-part1">
                <p class="name-account">Juscelino Lima</p>
                <p class="email-account">juscelinolima@gmail.com</p>
                <a class="perfil-account" href="perfil.html">Seu perfil ‚ûû</a>
              </div>
            </div>
            <div class="mn-part2">
                        <ul>
                            <li><a href="configuracoes.html"><img src="../assets/png/icones/icone_configuracoes.png" alt="" style="width: 25px; margin-right: 7px; vertical-align: middle;">Configura√ß√µes</a></li>
                        </ul>
            </div>
          </div>
        </div>
      </nav>
    </header>
    
    <div id="overlay"></div>

      <!--Topo do perfil (fixo)-->

    <div class="header-perfil" style="padding-top: 50px">
      <img class="header-image"
        src="../assets/jpg/teste-header-perfil.jpeg"
        alt=""
      />
    </div>
    <div class="info-perfil">
      <div class="perfil-containt">
        <div class="div-1">
          <div class="icon-profile">
            <img id="foto-perfil-ong" src="../assets/jpg/foto-perfil-exemplo.jpg" />
          </div>
          <h4 class="name-profile">Cartinha M√°gica</h4>
        </div>
        <div class="div-2">
          <p><span>10</span> publica√ß√µes</p>
          <p></p>
          <p><span id="txtseguidores"></span> seguidores</p>
        </div>
        <div class="div-3">
        </div>
      </div>
    </div>

    <div class="main-perfil">
      <section class="feed-profile">

      <div class="flex main-left" style="margin-top: -20px;">

        <!--Cole√ß√µes (fixo)-->
         
        <!--menu cole√ß√µes para mobile-->
        <div class="flex main-right">
              <div class="menu-perfil-mobile" id="abrir-secao-colecoes">
          <a style="font-weight: 700;" id="txt-abrir-secao-colecoes">Cole√ß√µes</a>
            </div>
        </div>
        
        <!--menu cole√ß√µes desktop-->
          <div class="itens-salvos" id="secap-colecoes">
            <div class="title-itens" id="titulo-secao-colecoes" ><h4>Cole√ß√µes</h4></div>

            <div class="elementos-salvos" >
              <div class="subcontainer-colecoes" id="subcontainer-colecoes">
              </div>

            </div>
          </div>

       <!--M√≠dia (fixo)-->
          <div class="container-midia" id="link-midia">
            <h4>
              <a id="link-midia-text">M√≠dia</a>
            </h4>
            <a class="ver-tudo"> &gt;</a>
          </div>
      </div>

        <div class="flex main-right">
          <div class="flex" style="align-items: center; justify-content: center; width: 100%">
            
          <!--Menu sobre e postagens (fixo) (desktop)-->
            <div class="menu-perfil">
              <article class="option-menu">
                <a id="link-sobre">Sobre</a>
              </article>
              <article class="option-menu">
                <a id="link-postagens">Postagens</a>
              </article>
            </div>

          <!--Menu sobre e postagens (fixo) (mobile)-->
            <div class="menu-perfil-mobile">
              <article class="option-menu">
                <a id="link-sobre-mobile">Sobre</a>
              </article>
              <article class="option-menu">
                <a id="link-postagens-mobile">Postagens</a>
              </article>
              <article class="option-menu">
                <a id="link-midia-mobile">M√≠dia</a>
              </article>
            </div>
          </div>

          <!-- ********** Se√ß√£o Postagens ********** -->
           <div id="secao-postagens" style="display: none; align-items: center; justify-content: center; width: 100%;">

            <div id="post-section"
            style="overflow-y: auto; max-height: 500px; display: flex; flex-direction: column; gap: 2rem; width: 90%;">
            <article class="post">
            </article>
          </div>
           </div>

           <!-- ********** Se√ß√£o Sobre ********** -->
        <div id="secao-sobre" style="display: none; flex-direction: column; align-items: center; justify-content: center; width: 100%;">
          <article class="sobreContainer">
            <div class="sobreCorpo">
              <h3 id="txtrazao_social"></h3>
              <p id="txtdescricao">
                
              </p>
            </div>
            <div class="sobreFooter">
              <div style="display: flex; align-items: center; gap: 8px">
                <img
                  src="../assets/png/icones/icone_calendario-fundacao-sobre.png"
                  alt=""
                  height="20px"
                  width="20px"
                /><span id="txtAdF"></span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px">
                <img
                  src="../assets/png/icones/icone_localizacao-sobre.png"
                  alt=""
                  height="20px"
                  width="20px"
                /><span id="txtcidade"></span>
              </div>
            </div>
          </article>
        </div>

    <!-- ********** Se√ß√£o M√≠dia ********** -->
    <div id="secao-midia" style="display: none; align-items: center; justify-content: center; width: 100%;">
      <article class="container secao-midia">
        <h4 class="titulo-midia">M√≠dia</h4>

        <section class="fotos-container" style="width: 90%; overflow-x: auto; overflow-y: hidden;">

        </section>  

        <div class="acoes-midia"></div>
      </article>
    </div>

        <!-- ********** Se√ß√£o Cole√ß√£o ********** -->

      <div id="secao-colecao" style="display: none; align-items: center; justify-content: center; width: 100%;">

          </div>  

        </div>
      </section>
    </div>

<!-- ********** MODAIS ********** -->

    <!--********** Salvar Publica√ß√£o Modal **********-->
    <div id="salvarPublicacao">
      <div class="cabecalho-post" style="border-bottom: 2px solid #f5f5f5">
        <div
          style="
            width: 95%;
            display: flex;
            justify-content: center;
            align-items: center;
          "
        >
          <h3 style="font-size: 12pt; color: #2c2f2c">Salvar em:</h3>
        </div>
        <a href="" class="sair" id="sairSalvarPublicacao">X</a>
      </div>

      <div class="corpo-post">
        <!-- Vai gerar automaticamente as cole√ß√µes -->
      </div>
      <br /><br />
      <div
        style="
          width: 100%;
          display: flex;
          justify-content: flex-end;
          padding: 1rem 0 0 0;
        "
      >
        <a class="btn-confirmar" id="btnConfirmarColecao">Concluir</a>
      </div>
    </div>



            <div id="lightbox-modal" class="lightbox-hidden">
        <span class="lightbox-close" onclick="closeLightbox()">√ó</span>
        <img id="lightbox-img" src="" alt="Imagem em destaque" />
         <button id="lightbox-prev" onclick="navigateLightbox(-1)">
    <img src="../assets/png/arrowuneong.png" alt="Anterior" />
  </button>
  <button id="lightbox-next" onclick="navigateLightbox(1)">
    <img src="../assets/png/arrowuneong.png" alt="Pr√≥xima" />
  </button>
    </div>


 <script>

    //backend

    
let dataONG = null;
let dataUser = null;
let usuarioLogadoId = null;

window.onload = async (usuarioLogadoId) => {
  try {
    params = new URLSearchParams(window.location.search)
    id = params.get("id")

    const res = await fetch(`/api/perfilOng/${id}`, {
      method: "GET",
      credentials: "include"
    });

    dataONG = await res.json();
    if (!res.ok) {
      alert(dataONG.error);
      window.location.href = "../cadastros/login-user.html";
      return;
    }

    // IMAGENS
    document.querySelector("#foto-perfil-ong").src = dataONG.foto_perfil_ong;
    document.querySelector(".header-image").src = dataONG.foto_header_ong;

    // INFORMA√á√ïES
    document.querySelector(".name-profile").textContent = dataONG.nome_ong;
    document.getElementById("txtseguidores").textContent = dataONG.seguidores;
    document.getElementById("txtrazao_social").textContent = 'Raz√£o Social: ' + dataONG.razao_social;
    document.getElementById("txtdescricao").textContent = dataONG.descri√ß√£o;
    document.getElementById("txtAdF").textContent = 'Fundada em ' + dataONG.AdF;
    document.getElementById("txtcidade").textContent = 'Localizada em ' + dataONG.cidade;

    window.ongId = dataONG.id_ong;

    listarColecoes(dataONG.id_ong)
    carregarFeed(dataONG.id_ong);

    console.log(dataONG);
  } catch (err) {
    console.error("Erro ao carregar dados ONG:", err);
  }

  
  try {
        const res = await fetch("/api/config", {
          method: "GET",
          credentials: "include" // necess√°rio para enviar o cookie da sess√£o
        });
        const data = await res.json();

        if (!res.ok) {
          alert(data.error);
          // redireciona
          window.location.href = "../cadastros/login-doador.html";
          return;
        }

        document.querySelector(".name-account").textContent = data.nome_ong;
        document.querySelector(".foto-perfil").src = data.foto_perfil_ong;
        document.querySelector(".email-account").textContent = data.email_ong;
        //INFORMA√á√ïES
        const foto = document.getElementById("foto_perfil4");
        foto.style.backgroundImage  = `url(${data.foto_perfil_ong})`;

  
        console.log(data)
        console.log("ID DA ONG -> " + data.id_ong)

        usuarioLogadoId = data.id_ong;
         console.log(usuarioLogadoId)
         carregarFeed(usuarioLogadoId)

      } catch (err) {
        console.error("Erro ao carregar dados:", err);
      }

carregarColecoesDoUsuario(dataUser.id_user);




async function carregarMidiasUsuario(idOng) {
  if (!idOng) return;
  const res = await fetch(`/api/midias/${idOng}`, { credentials: "include" });
  const midias = (await res.json()) || [];
  const fotosContainer = document.querySelector("#secao-midia .fotos-container");
  fotosContainer.innerHTML = "";

  midias.forEach(midia => {
    const urls = Array.isArray(midia.imagem_midia) ? midia.imagem_midia : [midia.imagem_midia];

    urls.forEach(url => {
      const article = document.createElement("article");
      article.classList.add("foto");
      article.style.cursor = "pointer";
      article.style.minWidth = "90px";
      article.style.minHeight = "90px";
      article.style.margin = "5px";

      if (url.match(/\.(mp4|webm|ogg)$/i)) {
        const video = document.createElement("video");
        video.src = url;
        video.controls = true;
        video.width = 100;
        video.height = 100;
        article.appendChild(video);
      } else {
        article.style.background = `url(${url})`;
        article.style.backgroundSize = "cover";
        article.style.backgroundPosition = "center";
      }

      article.addEventListener("click", () =>  abrirVisualizacaoMidia(url, midia.descricao_midia, midia.ONG?.nome_ong, midia.data_midia, midia.ONG?.foto_perfil_ong, midia.id_midia));
      fotosContainer.appendChild(article);
    });
  });
}



    


   

// Modal para visualiza√ß√£o

    // ABRE MODAL DE VISUALIZAR MIDIA
    function abrirVisualizacaoMidia(url, descricao, criador, data_midia, foto_perfil_ong, id_midia) {
      // Overlay

      let overlay = document.getElementById("overlay");
      if (!overlay) {
        overlay = document.createElement("div");
        overlay.id = "overlay";
        overlay.style.position = "fixed";
        overlay.style.top = "0";
        overlay.style.left = "0";
        overlay.style.width = "100%";
        overlay.style.height = "100%";
        overlay.style.background = "rgba(0,0,0,0.7)";
        overlay.style.display = "none";
        overlay.style.zIndex = "999";
        document.body.appendChild(overlay);

        overlay.addEventListener("click", () => {
          modalPost.style.display = "none";
          overlay.style.display = "none";
        });
      }

      // Modal
      let modalPost = document.getElementById("modalPost");
      if (!modalPost) {
        modalPost = document.createElement("div");
        modalPost.id = "modalPost";
        modalPost.style.display = "none";
        modalPost.style.position = "fixed";
        modalPost.style.top = "50%";
        modalPost.style.left = "50%";
        modalPost.style.transform = "translate(-50%, -50%)";
        modalPost.style.zIndex = "1000";

        //HTML DO MODAL
        modalPost.innerHTML = 
    `
      <div class="container-foto-modal">
        <div style="width: 100%; display: flex; align-items: center; padding: 0; height: 10px;">
          <a href="" class="sair">√ó</a>
        </div>


<div style="
  display: flex;
  width: 100%;
  height: 90%;
  padding: 10px;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  overflow: hidden; /* Impede o vazamento */
">
  <img 
    class="photo-post" 
    id="midia-img"
    style="
      max-width: 100%;
      max-height: 100%;
      object-fit: contain; /* Mant√©m propor√ß√£o e ajusta dentro do container */
    "
  >
</div>

      </div>

      <div class="container-legenda-modal">
        <div class="topo-legenda-modal">
          <div class="autor-photo" style="line-height: 5px">
            <img id="fotoCriador" src="" alt="" />
          </div>
          <div style="display: flex; flex-direction: column">
            <a class="autor" id="criadorMidia">Cartinha M√°gica</a>
            <a class="info">Itu - SP</a>
          </div>
        </div>

        <article class="postInfo">
          <div class="data-legenda-modal">
            <a class="info">${new Date(data_midia).toLocaleString("pt-BR")}</a>
          </div>
          <div class="texto-legenda-modal">
            <p class="txtPost" id="midia-descricao"></p>
          </div>
        </article>
      </div>`;

        document.body.appendChild(modalPost);

        // Bot√£o fechar
        const closeBtn = modalPost.querySelector(".sair");
        closeBtn.addEventListener("click", (e) => {
          e.preventDefault();
          modalPost.style.display = "none";
          overlay.classList.remove("show");
        });
      }

      // Atualiza imagem e descri√ß√£o
const midiaImg = modalPost.querySelector("#midia-img");
const midiaDescricao = modalPost.querySelector("#midia-descricao");
const criadorMidia = modalPost.querySelector("#criadorMidia");
const fotoCriador = modalPost.querySelector("#fotoCriador");

midiaImg.src = url;
midiaDescricao.textContent = descricao;
criadorMidia.textContent = criador;
fotoCriador.src = foto_perfil_ong;

      // Exibe modal e overlay
      overlay.classList.toggle("show");
      modalPost.style.display = "flex";

      overlay.addEventListener("click", () => {
        modalPost.style.display = "none";
        overlay.classList.remove("show");
      });

    }



// Chama a fun√ß√£o para carregar as m√≠dias do perfil da ONG
const idOng = dataONG.id_ong
console.log(idOng)
carregarMidiasUsuario(idOng);

};

async function verificarCurtida(postId) {
      try {
        console.log(usuarioLogadoId)
        const params = new URLSearchParams({
          id_post: postId,

          id_user: window.usuarioLogadoId
        });

        const res = await fetch(`/api/post/checkU?${params.toString()}`);
        const result = await res.json();

        const btn = document.querySelector(`.reaction[data-post-id="${postId}"]`);
        if (btn) {
          btn.textContent = result.jaCurtiu ? "Descurtir" : "Curtir";
          
        }
      } catch (err) {
        console.error("Erro ao verificar curtida:", err);
      }
    }

    async function carregarCurtidas(postId) {
      try {
        const res = await fetch(`/api/post/curtidas/${postId}`);
        const data = await res.json();

        const contador = document.getElementById(`curtidas-${postId}`);
        if (contador) {
          contador.textContent = data.totalCurtidas || 0;
        }
        console.log(data);
      } catch (err) {
        console.error("Erro ao carregar curtidas:", err);
      }
    }


    document.addEventListener("click", async (e) => {
      if (e.target.classList.contains("reaction")) {
        e.preventDefault(); // impede o <a> de recarregar a p√°gina

        const postId = e.target.dataset.postId;
        const usuarioId = e.target.dataset.usuarioId;

        console.log("Usu√°rio", usuarioId, "curtindo post", postId);
        try {
          const res = await fetch("/api/post/curtidas", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id_user: usuarioId, id_post: postId })
          });


          const result = await res.json();

          if (res.ok) {
            carregarCurtidas(postId)
            e.target.textContent = result.jaCurtiu ? "Descurtir" : "Curtir";

          }
          
        } catch (err) {
          console.error("Erro ao curtir:", err);
        }
      }
    });

 async function carregarFeed(id, usuarioLogadoId, contador) {
      const res = await fetch(`/api/perfilSeg?ongId=${id}`, {
        method: "GET",
        credentials: "include"
      });
      const posts = await res.json();

      const feedDiv = document.getElementById("post-section");
      feedDiv.innerHTML = `<div id="post-section" style="display: none; flex-direction: column; gap: 15px; transform: translateX(15px);"`;

      posts.forEach(post => {
        const postDiv = document.createElement("article");
        postDiv.classList.add("post");


        const midias = Array.isArray(post.imagem_url)
          ? post.imagem_url
          : JSON.parse(post.imagem_url || "[]");

        const midia = midias.map(url => {
          return url.endsWith(".mp4")
            ? `<video controls src="${url}" width="300"></video>`
            : `<img src="${url}" width="300" />`;
        }).join("");




        postDiv.innerHTML =`       
        <div class="autor-post">
        <div class="flex" style="flex-direction: column">
          <div class="flex">
            <div class="autor-photo">
              <img src="${post.ONG.foto_perfil_ong}" alt="" />
            </div>
            <a class="autor" href="../">${post.ONG?.nome_ong || "ONG desconhecida"}</a>
          </div>
          <span class="horario">
            ${new Date(post.data_hora).toLocaleString("pt-BR")}
          </span>
        </div>
        <div>
            
        </div>
      </div>

      <div class="corpo-post">
        <p>${post.conteudo_post}</p>
        <div class="fotos-post">
          ${midia}
        </div>
      </div>
      <div class="reactions-post">
        <div style="width: 100%; gap: 5px; align-items: center;" class="flex">
          <img src="../assets/png/icones/icone_curtir.png" width="16px" height="16px" alt="">
          <span style=" color: #a6a6a6; font-weight: bold; font-size: 13px;" id="curtidas-${post.id_post}">${post.totalCurtidas || 0}</span>
        </div>
        <a class="reaction"
        data-post-id="${post.id_post}" 
       data-usuario-id="${window.usuarioLogadoId}"
       id="CurTDesC" >${post.jaCurtiu ? "Descurtir" : "Curtir"}</a>
        <a class="reaction">Compartilhar</a>
      </div>`;

        verificarCurtida(post.id_post, usuarioLogadoId);
        feedDiv.appendChild(postDiv);
            

      }
    ); configurarEventosPosts();
    }

    



function configurarEventosPosts() {
  document.querySelectorAll(".options-post").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      const container = btn.parentElement;
      container.classList.toggle("active");
      e.stopPropagation();
    });
  });

  document.querySelectorAll(".btnSalvarPost").forEach((btn) => {
    btn.addEventListener("click", () => {
      abrir(document.getElementById("salvarPublicacao"));
    });
  });
}



    carregarFeed(window.ongId).then(() => configurarEventosPosts());

        async function listarColecoes(id_ong) {
  try {
    // Substitua pelo ID do usu√°rio logado ou use sess√£o
    const ongId = id_ong; // se necess√°rio
    const response = await fetch(`/api/colecoesOng/${ongId}`);
    const colecoes = await response.json();

    const container = document.getElementById("subcontainer-colecoes");
    container.innerHTML = ""; // limpa o container antes de preencher

    colecoes.forEach((colecao) => {
      const primeiraLetra = colecao.nome_colecao_ong.charAt(0).toUpperCase();

      const artigo = document.createElement("article");
      artigo.classList.add("item-colecao");

      artigo.innerHTML = `
        <a class="icon-colecao">${primeiraLetra}</a>
        <a onclick="carregarColecao(${colecao.id_colecao_ong})">${colecao.nome_colecao_ong}</a>

      `;

      container.appendChild(artigo);
    });
  } catch (error) {
    console.error("Erro ao listar cole√ß√µes:", error);
  }
}

      //scripts para esconder/aparecer as se√ß√µes

      const secaoSobre = document.getElementById("secao-sobre");
      const secaoPostagens = document.getElementById("secao-postagens");
      const secaoMidia = document.getElementById("secao-midia");
      const secaoColecao = document.getElementById("secao-colecao");

      const linkSobre = document.getElementById("link-sobre");
      const linkPostagens = document.getElementById("link-postagens");
      const linkMidia = document.getElementById("link-midia");
      const linkMidiaText = document.getElementById("link-midia-text");
      const linkColecao = document.querySelectorAll(".item-colecao");

      const linkSobreMobile = document.getElementById("link-sobre-mobile");
      const linkPostagensMobile = document.getElementById("link-postagens-mobile");
      const linkMidiaMobile = document.getElementById("link-midia-mobile");

      secaoSobre.style.display = "flex";
      linkSobre.style.color = "#e74c3c";
      linkSobreMobile.style.color = "#e74c3c";

      //evento de clicar no botao de postagens
      linkPostagens.addEventListener("click", () => {
        secaoPostagens.style.display = "flex";
        secaoSobre.style.display = "none";
        secaoMidia.style.display = "none";
        secaoColecao.style.display = "none";

        linkPostagens.style.color = "#e74c3c";
        linkPostagens.style.fontWeight = "bold";
        linkSobre.style.color = "";
        linkMidiaText.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      });

      //evento de clicar no botao de sobre
      linkSobre.addEventListener("click", () => {
        secaoSobre.style.display = "flex";
        secaoPostagens.style.display = "none";
        secaoMidia.style.display = "none";
        secaoColecao.style.display = "none";

        linkSobre.style.color = "#e74c3c";
        linkSobre.style.fontWeight = "bold";
        linkPostagens.style.color = "";
        linkMidiaText.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      });

      //evento de clicar no botao de midia
      linkMidia.addEventListener("click", () => {
        secaoMidia.style.display = "flex";
        secaoPostagens.style.display = "none";
        secaoSobre.style.display = "none";
        secaoColecao.style.display = "none";

        linkMidiaText.style.color = "#e74c3c";
        linkMidiaText.style.fontWeight = "bold";
        linkSobre.style.color = "";
        linkPostagens.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      });


  async function carregarColecoesDoUsuario(id_criador) {

  if (!id_criador) {
    console.error("ID do criador n√£o encontrado.");
    return;
  }

  try {
    const response = await fetch(`/api/colecoes/${id_criador}`, {
  method: "GET",
  credentials: "include"
});
    if (!response.ok) {
      throw new Error("Erro ao buscar cole√ß√µes");
    }

    const colecoes = await response.json();

    const container = document.querySelector("#salvarPublicacao .corpo-post");
    container.innerHTML = "";

    if (!colecoes.length) {
      container.innerHTML = "<p style='color: gray; text-align:center;'>Nenhuma cole√ß√£o criada ainda.</p>";
      return;
    }

    colecoes.forEach((colecao) => {
      const div = document.createElement("div");
      div.classList.add("subcontainer");

      const label = document.createElement("label");
      label.setAttribute("for", `colecao-${colecao.id_colecao}`);
      label.textContent = colecao.nome_colecao;

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.id = `colecao-${colecao.id_colecao}`;
      checkbox.name = "colecoes";
      checkbox.value = colecao.id_colecao;
      checkbox.style.borderRadius = "50%";

      div.appendChild(label);
      div.appendChild(checkbox);
      container.appendChild(div);
    });
  } catch (error) {
    console.error("Erro ao carregar cole√ß√µes:", error);
  }
}

// Vari√°vel global para armazenar o post selecionado
let idPostSelecionado = null;

// 1Ô∏è‚É£ Event delegation para capturar clique em qualquer bot√£o .btnSalvarPost
document.addEventListener("click", (event) => {
  const botao = event.target.closest(".btnSalvarPost");
  if (!botao) return; // ignora se n√£o for um bot√£o de salvar post

  event.preventDefault();

  // Armazena o ID do post clicado
  idPostSelecionado = botao.dataset.idPost;
  console.log("Post selecionado:", idPostSelecionado);

  // Aqui voc√™ pode chamar a fun√ß√£o que abre o modal ou apenas preparar os dados
  // abrirModal(); // se tiver modal
});

// 2Ô∏è‚É£ Fun√ß√£o para salvar o post nas cole√ß√µes selecionadas
async function salvarPostEmColecoes() {
  if (!idPostSelecionado) {
    alert("Erro: nenhuma postagem selecionada.");
    return;
  }

  // Seleciona todos os checkboxes marcados
  const selecionadas = Array.from(document.querySelectorAll('input[name="colecoes"]:checked'));
  if (selecionadas.length === 0) {
    alert("Selecione pelo menos uma cole√ß√£o.");
    return;
  }

  try {
    for (const checkbox of selecionadas) {
      const id_col = checkbox.value;

      const response = await fetch(`/api/colecao/item`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id_col, id_post: idPostSelecionado }),
        credentials: "include"
      });

      const result = await response.json();
      if (!response.ok) throw new Error(result.error || "Erro ao salvar");
    }

    alert("Postagem salva com sucesso nas cole√ß√µes selecionadas!");
    idPostSelecionado = null;

    // Limpa checkboxes
    document.querySelectorAll('input[name="colecoes"]').forEach(c => c.checked = false);

  } catch (error) {
    console.error("Erro ao salvar nas cole√ß√µes:", error);
    alert("Ocorreu um erro ao salvar a postagem.");
  }
}

// 3Ô∏è‚É£ Bot√£o de confirma√ß√£o (pode estar no modal ou na p√°gina)
document.addEventListener("click", (event) => {
  if (event.target.matches("#btnConfirmarColecao")) {
    event.preventDefault();
    salvarPostEmColecoes();
  }
});

async function carregarColecao(idColecao) {
  try {
    const res = await fetch(`/api/colecaoOng/${idColecao}`, {
      method: "GET",
      credentials: "include"
    });

    if (!res.ok) throw new Error("Erro ao carregar posts da cole√ß√£o");

    const posts = await res.json();

    const colecaoDiv = document.getElementById("secao-colecao");
    colecaoDiv.innerHTML = "";
    colecaoDiv.style.flexDirection = "column";
    colecaoDiv.style.gap = "15px";

    if (!posts.length) {
      colecaoDiv.innerHTML = `<p style="text-align:center; color: gray;">Nenhuma postagem nesta cole√ß√£o.</p>`;
      return;
    }

    posts.forEach(post => {
      const postDiv = document.createElement("article");
      postDiv.classList.add("post");

      const midias = Array.isArray(post.imagem_url)
        ? post.imagem_url
        : JSON.parse(post.imagem_url || "[]");

      const midia = midias.map(url => {
        return url.endsWith(".mp4")
          ? `<video controls src="${url}" width="300"></video>`
          : `<img src="${url}" width="300" />`;
      }).join("");

      postDiv.innerHTML = `
        <div class="autor-post">
          <div class="flex" style="flex-direction: column;">
            <div class="flex">
              <div class="autor-photo">
                <img src="${post.ONG.foto_perfil_ong}" alt="" />
              </div>
              <a class="autor" href="../">${post.ONG?.nome_ong || "ONG desconhecida"}</a>
            </div>
            <span class="horario">${new Date(post.data_hora).toLocaleString("pt-BR")}</span>
          </div>
          <div>
          </div>
        </div>
        <div class="corpo-post">
          <p>${post.conteudo_post}</p>
          <div class="fotos-post">${midia}</div>
        </div>
        <div class="reactions-post">
          <div style="width: 100%; gap: 5px; align-items: center;" class="flex">
            <img src="../assets/png/icones/icone_curtir.png" width="16px" height="16px" alt="">
            <span style=" color: #a6a6a6; font-weight: bold; font-size: 13px;">100</span>
          </div>
          <a class="reaction">Curtir</a>
          <a class="reaction" href="">Compartilhar</a>
        </div>
      `;

      colecaoDiv.appendChild(postDiv);
      console.log("üß† id_cItem enviado:", post.id_citem_ong);
      console.log(post)
    });

    configurarEventosPosts();
    postsFuncoes();

  } catch (error) {
    console.error("Erro ao carregar posts da cole√ß√£o:", error);
  }
}

async function postsFuncoes() {
    document.querySelectorAll('.fotos-post').forEach(galeria => {
      const qtd = galeria.querySelectorAll('img').length;
      galeria.classList.add(`fotos-post-${qtd}`);
    });

    let currentImageIndex = 0;
    let imageList = [];

    // Adiciona evento em todas as imagens
    document.querySelectorAll('.fotos-post img').forEach(img => {
      img.addEventListener('click', () => {
        const parent = img.closest('.fotos-post');
        imageList = Array.from(parent.querySelectorAll('img')).map(i => i.src);
        currentImageIndex = imageList.indexOf(img.src);
        openLightbox();
      });
    });

    function openLightbox() {
      const modal = document.getElementById('lightbox-modal');
      const img = document.getElementById('lightbox-img');
      const prevBtn = document.getElementById('lightbox-prev');
      const nextBtn = document.getElementById('lightbox-next');

      const showButtons = imageList.length > 1;
      prevBtn.style.display = showButtons ? 'flex' : 'none';
      nextBtn.style.display = showButtons ? 'flex' : 'none';

      modal.classList.remove('lightbox-hidden');
      img.src = imageList[currentImageIndex];
    }

    function closeLightbox() {
      document.getElementById('lightbox-modal').classList.add('lightbox-hidden');
    }

    function navigateLightbox(direction) {
      currentImageIndex += direction;

      if (currentImageIndex < 0) currentImageIndex = imageList.length - 1;
      if (currentImageIndex >= imageList.length) currentImageIndex = 0;

      document.getElementById('lightbox-img').src = imageList[currentImageIndex];
    }

    // Bot√£o fechar
    const closeBtn = document.querySelector(".lightbox-close");
    if (closeBtn) closeBtn.addEventListener("click", closeLightbox);

    // Navega√ß√£o
    const prevBtn = document.getElementById("lightbox-prev");
    if (prevBtn) prevBtn.addEventListener("click", () => navigateLightbox(-1));

    const nextBtn = document.getElementById("lightbox-next");
    if (nextBtn) nextBtn.addEventListener("click", () => navigateLightbox(1));

    // === Fecha ao clicar no fundo (parte escura) ===
    const modal = document.getElementById("lightbox-modal");
    if (modal) {
      modal.addEventListener("click", (e) => {
        // s√≥ fecha se clicar fora da imagem e dos bot√µes
        if (e.target === modal) {
          closeLightbox();
        }
      });
    }

}




    </script>

    <script>
document.addEventListener("DOMContentLoaded", () => {

  setTimeout(() => {


      //scripts para esconder/aparecer as se√ß√µes

      const secaoSobre = document.getElementById("secao-sobre");
      const secaoPostagens = document.getElementById("secao-postagens");
      const secaoMidia = document.getElementById("secao-midia");
      const secaoColecao = document.getElementById("secao-colecao");

      const linkSobre = document.getElementById("link-sobre");
      const linkPostagens = document.getElementById("link-postagens");
      const linkMidia = document.getElementById("link-midia");
      const linkMidiaText = document.getElementById("link-midia-text");
      const linkColecao = document.querySelectorAll(".item-colecao");

      const linkSobreMobile = document.getElementById("link-sobre-mobile");
      const linkPostagensMobile = document.getElementById("link-postagens-mobile");
      const linkMidiaMobile = document.getElementById("link-midia-mobile");

      secaoSobre.style.display = "flex";
      linkSobre.style.color = "#e74c3c";
      linkSobreMobile.style.color = "#e74c3c";

      //evento de clicar no botao de postagens
      linkPostagens.addEventListener("click", () => {
        secaoPostagens.style.display = "flex";
        secaoSobre.style.display = "none";
        secaoMidia.style.display = "none";
        secaoColecao.style.display = "none";

        linkPostagens.style.color = "#e74c3c";
        linkPostagens.style.fontWeight = "bold";
        linkSobre.style.color = "";
        linkMidiaText.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      });

      //evento de clicar no botao de sobre
      linkSobre.addEventListener("click", () => {
        secaoSobre.style.display = "flex";
        secaoPostagens.style.display = "none";
        secaoMidia.style.display = "none";
        secaoColecao.style.display = "none";

        linkSobre.style.color = "#e74c3c";
        linkSobre.style.fontWeight = "bold";
        linkPostagens.style.color = "";
        linkMidiaText.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      });

      //evento de clicar no botao de midia
      linkMidia.addEventListener("click", () => {
        secaoMidia.style.display = "flex";
        secaoPostagens.style.display = "none";
        secaoSobre.style.display = "none";
        secaoColecao.style.display = "none";

        linkMidiaText.style.color = "#e74c3c";
        linkMidiaText.style.fontWeight = "bold";
        linkSobre.style.color = "";
        linkPostagens.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      });

//evento de clicar no botao de colecao
linkColecao.forEach(element => {
  element.addEventListener("click", function () {
    secaoColecao.style.display = "flex";
    secaoPostagens.style.display = "none";
    secaoSobre.style.display = "none";
    secaoMidia.style.display = "none";

    // Remove destaque de todos
    linkColecao.forEach(el => {
      el.style.color = "";
      el.style.fontWeight = "";
    });

    // Destaca apenas o clicado
    element.style.fontWeight = "bold";
    element.style.color = "#e74c3c";    

    linkMidiaText.style.color = "";
    linkSobre.style.color = "";
    linkPostagens.style.color = "";
    linkMidiaMobile.style.color = "";
    linkSobreMobile.style.color = "";
    linkPostagensMobile.style.color = "";
    
  });
});


  //MENU PARA MOBILE

     linkPostagensMobile.addEventListener("click", () => {
        secaoPostagens.style.display = "flex";
        secaoSobre.style.display = "none";
        secaoMidia.style.display = "none";
        secaoColecao.style.display = "none";

        linkPostagensMobile.style.color = "#e74c3c";
        linkPostagensMobile.style.fontWeight = "bold";
        linkSobreMobile.style.color = "";
        linkMidiaMobile.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      });

      linkSobreMobile.addEventListener("click", () => {
        secaoSobre.style.display = "flex";
        secaoPostagens.style.display = "none";
        secaoMidia.style.display = "none";
        secaoColecao.style.display = "none";

        linkSobreMobile.style.color = "#e74c3c";
        linkSobreMobile.style.fontWeight = "bold";
        linkPostagensMobile.style.color = "";
        linkMidiaMobile.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      }); 

      linkMidiaMobile.addEventListener("click", () => {
        secaoMidia.style.display = "flex";
        secaoPostagens.style.display = "none";
        secaoSobre.style.display = "none";
        secaoColecao.style.display = "none";

        linkMidiaMobile.style.color = "#e74c3c";
        linkMidiaMobile.style.fontWeight = "bold";
        linkSobreMobile.style.color = "";
        linkPostagensMobile.style.color = "";
        linkColecao.forEach(el => {
          el.style.color = "";
          el.style.fontWeight = "";
    });
      }); 

      //Vers√£o mobile da se√ß√£o cole√ß√µes (aparecer/desaparecer)
        const abrirSecaoColecoes = document.getElementById('abrir-secao-colecoes');
        const secaoColecoes = document.getElementById('menu-colecoes');
        const TxtAbrirSecaoColecoes = document.getElementById('txt-abrir-secao-colecoes');

        abrirSecaoColecoes.addEventListener('click', (e) => {
            e.preventDefault();
            secaoColecoes.classList.toggle('show');

            TxtAbrirSecaoColecoes.style.color = "#e74c3c";

            if (secaoColecoes.classList.contains('show')) {
        TxtAbrirSecaoColecoes.style.color = "#e74c3c"; // cor quando est√° aberto
    } else {
        TxtAbrirSecaoColecoes.style.color = ""; // volta √† cor padr√£o quando fechado
    }
        });
  }, 2500); 
});

</script>



    <script src="../js/funcionalidades.js"></script>
    <script src="../js/modals/modalPost.js"></script>
    <script src="../js/feed.js"></script>
    <script src="../js/search.js"></script>
          <script src="../js/carregamento.js"></script>
  </body>
</html>
